---
title: "Inight in world bank data"
output: html_document
---

# Fianl Project (TU Delft - EPA1315 Data Analysis and Visualization)

## introduction

The full version of this work is [hosted on GitHub](https://github.com/jasonrwang/OECD_insights).

### Authors

* Mees Hoff – 4963059
* Siemon Keij - 4285654
* Philip Seijger - 4272803
* Jason R Wang - 4788281

## Executive Summary

### Grading rubric
Follow DRISP DM process!!
## Problem Understanding
Scott: A problem is compellingly described Both data and graphics are compellingly used.

## Graphics and Visuallization
Scott: Multiple effective graphics are shown throughout the report

## Data and Preparation
Scott: Exceptional efforts were made to collect additional data or to fuse multiple data sets.

## Analysis
Scott: The model selected is strongly motivated and additional insight is provided

## Reporting
Scott: The report invites clear next steps for additional analysis or decision-making.
###


## Introduction
- Mees

## Problem Understanding
- Mees

# Old text, still up to date? - Mees
## Problem Understanding
_What is the problem? Who is the client? (This might be provided)_ - Mees already wrote an introduction.

### Age dependency ratio

The age dependency ratio is the ratio between the number of people in the labour force, and the number of people that are not. For further analysis, this ratio can be divided in old-age dependency ratio and young-age dependency ratio. The old-age ratio refers to the number of people that have reached the age of retirement (65+). The young-age dependency ratio refers to the number of people, that are too younger than 15.  (United Nations, 2005).

### Issues

Age dependency ratios are used to indicate potential effects of change in the population age structures. These effects are mainly related to social and economic development, that point out broad trends in social support needs. In general, a higher dependency rate tends to increase financial stress between working people and dependents. It can cause serious problems if large proportions of governmental spending are related to social security, health and education, since these are most used by the dependents (both old and young). The fewer people in the working age, the fewer can support the costs related to the dependents.


### Limitations

The definition of age dependency ratio ignores some significant facts. Firstly, people above the age of 65 are not necessarily dependent, since an increasing part of them is working nowadays. Also, people in the working age are not all working. People stay out of work for a number of reasons. First and foremost, some people are simply unemployed.  Also, people that follow education for a longer amount of time have a disturbing impact on the reliability of this definition.


### Trends

The life expectancy of people all over the world has significantly increased over the past decades. This increase can be explained by a number of reasons, but most importantly it is due three reasons. These reasons are better food production and distribution, improvement in public health and better medical technology [1]. According to a study in 188 countries, in the last two decades the life expectancy is especially increased due to lower death rates caused by infectious and cardiovascular diseases [2].

Unlike the life expectancy, age of retirement did not change much in most countries. This has as direct consequence that the age dependency ratio has decreased over the past decades. In figure 1 the age dependency of the world is depicted over the period from 1960 until 2017 (World Data Bank, 2017). It can be seen that global age dependency decreased from approximately 75% towards 54%.

! [Global Age Dependency Ratio](Picture)

To further analyse the ongoing trend of age dependency over the past years, in figure 2 a map of the age dependency per country in 1960 is given. In figure 3 these data can be compared to the numbers of age dependency in 2017. The difference becomes most evident by comparing the legends of both maps. (World Data Bank, 2017)

! [Age Dependency Ratio 1960] (picture)
! [Age Dependency Ratio 2017] (picture)

*Note: The colours of both pictures relate to different ratios, since the global distribution of age dependency was completely different in 1960, compared to 2017.

Lastly, figure 4 provides a prediction for the number of old-age dependent people over the world for the coming decades. A distinction is made for more developed regions, less developed regions and least developed countries (United Nations, 2015).

! [Population aged 60-79 years and aged 80 years or over by development group, 2000, 2015, 2030 and 2050] (picture)

Policy Actualities

Nowadays approximately 20% of the people in Europe is aged over 65, which is a record high.
This increase in life expectancy and its impact on the age dependency ratio has caused discussions about the age of retirement. In the countries that are part of the Organisation for Economic Co-operation and Development (OECD), men retire at an average age of 65, for women this is 63.5 [3].
In 2013 the Dutch government, for instance, decided to start increasing the age of retirement periodically [4], but not only in Europe this discussion is ongoing. The prime minister of Canada decided in 2016 to keep the retirement age at 65, but the plan to increase retirement age is still on the agenda [5].


Relevance for Organisation for Economic Co-operation and Development (OECD)

This subject is of particular interest to the strategic counsellor of the OECD for a number of reasons. Firstly, the increase of life expectancy is especially relevant in the member states of this organization, since these are mostly more developed countries (figure 4). Also, the economic consequences are highly relevant towards the OECD, since its main interest is economic development. Lastly, the OECD has stated its interest in the 7 societal challenges set by the UN. This problem is part of the Health and Demographic Change & Wellbeing challenge. The fact that the topic of ageing is explicitly mentioned in the global issue report of the United Nations, strengthen this statement [6].

For these reasons, the request for this report was made. The main research question is:




‘Will an increasing age-dependency ratio increase the stress on a society?’

This research question aims to relate the age-dependency ratio, both young and old, on several criteria for stress on a society. For each of the criteria a hypothesis is set, and in some cases an indicator is defined. In this report the criteria for stress are:

1.	Life Expectancy

Life expectancy is defined as the age a person is expected to reach, measured from its moment of birth. For this definition it is assumed that mortality rates at reach age remain constant. This variable is chosen, since it is believed to be the cause of many of the problems related to the increase of the age dependency ratio.

[Hypothesis 1: Life expectancy is positively related to an increase in the age dependency ratio]

2.	Cost of Healthcare

This criterium is chosen because it related to an increase in cost for the supporting part of society. For this reason, it can be considered a contributing factor towards stress on society. Reasons for this fact are for instance higher probability on chronic diseases such as Alzheimer of Dementia, but also increase chance on cancer or heart problems. Another contributing factor is the number of people in nursing houses or assisted living centres.

Indicator: Cost of healthcare is measured as the average cost of healthcare per person in a country ($ per person per year).

[Hypothesis 2: Cost of healthcare is positively related to an increase in the age dependency ratio]

3.	Cost of Living

This variable is chosen because cost of living is considered an economic indicator relevant to our problem. It also is believed to increase financial stress on a society. For instance, a high cost of living an indicator that a further increase of costs may be problematic.

Indicator: Cost of living is measured as the minimum amount of money that is needed for a certain standard of living ($ per person per year)

[Hypothesis 3: Cost of living is positively related to an increase in the age dependency ratio]

4.	Population

This variable is included to be able to relate to other variables such as GDP and its relation towards age dependency. A direct link towards stress is not observed.

Indicator: Number of people living in a country

[Hypothesis 4: The population is positively related towards an increase in the age dependency ratio]


5.	Economic Performance

Economic performance is chosen because a country that is doing well economically, is expected to be less vulnerable towards stress.

Indicator: Gross domestic product ($ per year)

The gross domestic product is a measure of total market value is a country. Nominal GDP is chosen, because this is regularly considered a suitable indicator of economic performance.

[Hypothesis 5: Economic performance is negatively related towards the age dependency ratio]

6.	Income inequality

Income inequality is chosen because of its relevance towards the economic situation is a country. It is an indication of differences between people is a country, also in terms of stress.

Indicator: Gini Index (%)

The Gini index represents the income or wealth distribution of a nation’s residents.

[Hypothesis 6: Income inequality has no significant relation towards the age dependency ratio.
### End old text - Mees






#### *Research Question*: Will increasing the age-dependency ratio increase the stress on a society?

### Methodology
This project is created following the Cross-industry standard process for data mining (DRISP-DM). This process starts with understanding the business, whith help of data understanding. This understanding helps to make sound decisions on how to prepare the data. During which the modeling will be done, which bepends on the acquired data. After the modeling, there's an evaluation which might lead to changes in business understanding. Eventually deployment follows evaluation.

#Inserct picture of DRISP-DM overview

## Data Understanding
The acquired data comes from the world bank. All this data has the same template. The first four columns are about the countries and the indicator, every indicator has it's own file. What each indicator is, is already discussed in the chapter about problem understanding. A short version of the selected criteria will be presented below.


| Criteria      | Description           | Possible relation  |
| ------------- |:-------------:| -----:|
| Age dependency old    | People over the age of 65 as percentage of the labour force |  |
| Age dependency young      | People under the age of 15 as percentage of the labour force      |   If there are a lot of young people now, at some point they will be 65+, thus increasing age dependency old (as seen by the babyboom generation) |
| GDP per capita | Gross domestic product devided by the number of people in the country      | If there are more people spending more money, the GDP will rise. Older people have in general more to spend than younger people |
| Healtcare expenditure | Expenditure as percentage of GDP | Older people need in general more healtcare, thus the expenditures might rise |


### Quality Discussion

The quality of the data will be set on how much data is missing. Data might be missing if the data wasn't recorded or wasn't complete. After looking through the dataframes, it became clear that only for the last couple of years a lot of data was gathered. Before the turn of the century, the data was very limited. Specially the last three years, the amount of data was much better than at the start of the recording of data.

Because missing data is excluded from the research, they have influence on the conclusion. The conclusion might not be correct for the missing countries. There might even be a correlation between the countries that miss data and which data is gathered, but that's research for another time.

### Exploratory Analysis

After the initial data was found, it became clear that not all data was relevant for the research question. Only the aformentioned data was used. The main reason for dropping data was that it wasn't very well conected with age dependancy old, or the unit of measurement could be improved by using another dataset.

## Data Preparation

### Dataset + Dataset Description

Every dataset as initially headers which are replaced during cleaning for easier reference later on. This is the code for importing and cleaning the data.

```{R}
## This file imports and cleans the data for all the variables and indicators we aim to examine.
## It then considates all of the data in one dataframe with rows sep

library(reshape)

# Import data, which is all from the World Bank Indicators database
age_dependency_old <- read.csv("data/API_SP.POP.DPND.OL_DS2_en_csv_v2_10184911.csv",sep=',',header=TRUE,skip=4)
age_dependency_young <- read.csv("data/API_SP.POP.DPND.YG_DS2_en_csv_v2_10199819.csv",sep=',',header=TRUE,skip=4)
age_dependency_ratio <- read.csv("data/API_SP.POP.DPND_DS2_en_csv_v2_10188478.csv",sep=',',header=TRUE,skip=4)
GDP <- read.csv("data/API_NY.GDP.MKTP.CD_DS2_en_csv_v2_10203569.csv",sep=',',header=TRUE,skip=4)
health_expenditure_capita <- read.csv("data/API_SH.XPD.EHEX.PC.CD_DS2_en_csv_v2_10203894.csv",sep=',',header=TRUE,skip=4)
health_expenditure <- read.csv("data/API_SH.XPD.CHEX.GD.ZS_DS2_en_csv_v2_10183765.csv",sep=',',header=TRUE,skip=4)
household_consumption <- read.csv("data/API_NE.CON.PRVT.CD_DS2_en_csv_v2_10184156.csv",sep=',',header=TRUE,skip=4)
GINI <- read.csv("data/API_SI.POV.GINI_DS2_en_csv_v2_10181010.csv",sep=',',header=TRUE,skip=4)
life_expectency_birth <- read.csv("data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_10181296.csv",sep=',',header=TRUE,skip=4)
total_popuation <- read.csv("data/API_SP.POP.TOTL_DS2_en_csv_v2_10203548.csv",sep=',',header=TRUE,skip=4)
GDP_per_capita <- read.csv("data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_10181232.csv",sep=',',header=TRUE,skip=4)

# View(head(age_dependency_old))

#create a list of all the names of the dataframes and the generic header names we want
str_of_dataframes <- c('age_dependency_old','age_dependency_young','GDP','household_consumption','GDP_per_capita','age_dependency_ratio','health_expenditure_capita','health_expenditure','GINI','life_expectency_birth','total_popuation')
header_names <- c('Country_Name', 'Country_Code', 'Indicator_Name','Indicator_Code',1960:2017)

country_code <- read.csv("data/Metadata_Country.csv",sep=",",header=TRUE,skip=0)
colnames(country_code)[1] <-"CountryCode" #change the name of the first row
country_code <- country_code[!(country_code$Region == ""), ] #keep only countries and skip aggregated inputs

CleanDataFrame <- function(D) {
    D[length(D)] <- NULL #delete the last column, it is empty
    colnames(D) <- header_names #change the headernames to be the same
    return(D)
}

OnlyCountries <- function(D) {
    D <- subset(D,D$Country_Code %in% country_code$CountryCode)
    return(D)
}

#walk through the list and change it according to the function
for (i in 1:length(str_of_dataframes)) {
    assign(str_of_dataframes[i], CleanDataFrame(get(str_of_dataframes[i])))
    assign(str_of_dataframes[i], OnlyCountries(get(str_of_dataframes[i])))

}

# Combine all indicators into one DataFrame
AllInds = data.frame()

for (indicator in str_of_dataframes) {
    # print(names(get(indicator)))
    AllInds = rbind(AllInds, get(indicator))
}

# Reshape the combined DataFrame

AllInds_melted = melt(AllInds, id = c('Country_Name','Country_Code','Indicator_Name','Indicator_Code'), variable_name='Year')
AllInds_cast = cast(AllInds_melted, Country_Name + Year ~ Indicator_Code)

```

After the data is cleaned, it isn't yet ready for further use. It should first be normalized and pasted together. That is done in the following block of code.


```{R}
library(gclus)
library(rlist)

Reshape <- function(which_year, dataframe) {
    keeps <- c("Country_Name", as.character(which_year))
    dataframe <- dataframe[, keeps, drop = FALSE]
    dataframe <- reshape(dataframe, direction = "long", varying = list(names(dataframe)[2]), v.names = str_of_dataframes[i],
                 idvar = c("Country.Name"), timevar = "Year", times = as.character(which_year))
}

var_names <- paste("df", 1:length(str_of_dataframes), sep = "")
# p_all <- mget(var_names, envir = globalenv())

for (i in 1:length(str_of_dataframes)) {
    assign(var_names[i], Reshape(2015, get(str_of_dataframes[i])))
}

data <- get(var_names[1])
for (i in 2:length(str_of_dataframes)) {
    data <- Reduce(function(x, y) merge(x, y, all=TRUE), list(data, get(var_names[i])))
}
all_data <- data
data <- data[complete.cases(data), ]

# Normalize data
normFunc <- function(x) {
    (x-mean(x, na.rm = T))/sd(x, na.rm = T)
}

data[match(str_of_dataframes[1], names(data)):ncol(data)] <- apply(data[match(str_of_dataframes[1], names(data)):ncol(data)], 2, normFunc)

# Create scatterplot matrix
dta <- data[c(match(str_of_dataframes[1],names(data)):ncol(data))] # get data
dta.r <- abs(cor(dta)) # get correlations
dta.col <- dmat.color(dta.r) # get colors
dta.o <- order.single(dta.r) # reorder variables so those with highest correlation are closest to the diagonal
cpairs(dta, dta.o, panel.colors=dta.col, gap=.5,
       main="Normalized Variables Ordered and Colored by Correlation" )


```

The function to select 50 countries was left out, because the year that was chosen has data for most countries, thus only the countries in the beginning of the alphabet would be selected.

The function created to find these countries is given below, but isn't used.

```{R, eval=F, echo=T}
CountrySelector <- function(data) {
  DataFrames <- list(data)  # list all dataframes fed to CountrySelector
  l2 <- lapply(DataFrames, function(x) cbind(x, na_count = rowSums(is.na(x))))  # Add column with NA-value count per row
  l3 <- Reduce(rbind, l2)  # Create one big dataframe
  l4 <- aggregate(x = l3$na_count, by = list(l3$Country_Name), FUN = sum)  # Combined NA-value counts for all dataframes per country
  l5 <- l4[order(l4$x),]  # Order ascending
  CountryList <- list(head(l5$Group.1, 50))  # List 50 countries with lowest NA-value counts
  return(CountryList)
}

selected_countries <- CountrySelector(all_data)

```

## Modelling
This should include
* Define a descriptive model for the relevant data
* Specify a prior distribution on the parameters
* Use Bayesian inferenc eto re-allocate credibility across parameter values

### Test Design

### Models

### Parameter sections

### Model Description

### Assessment


## References

## Appendix

### The General Data Cleaning Procedure
We were inspired by this, which Philip found at [website name](https://url).

![Data Processing Workflow](https://i.imgur.com/sIfLdkW.jpg)
